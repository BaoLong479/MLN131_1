
<aside 
  class="bg-white shadow-lg flex-shrink-0 flex flex-col border-r border-gray-200 h-full transition-all duration-300 relative"
  [class.w-80]="!isCollapsed()"
  [class.w-0]="isCollapsed()"
  [class.overflow-hidden]="isCollapsed()">
  <!-- Header with gradient and collapse button -->
  <div class="p-4 sm:p-5 border-b border-gray-200 bg-gradient-to-r from-red-500/10 to-pink-500/10 flex items-center justify-between">
    <h2 class="text-lg sm:text-xl font-bold text-gray-800">Mục lục</h2>
    <button
      (click)="toggleSidebar()"
      class="p-2 rounded-lg hover:bg-red-100 transition-colors text-red-600"
      title="Thu gọn">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>
  
  <!-- Scrollable navigation -->
  <nav class="p-4 overflow-y-auto flex-1 custom-scrollbar">
    <ul class="space-y-2">
      @for (chapter of chapters(); track chapter.id) {
        <li class="mb-1">
          <!-- Chapter header - clickable to expand/collapse -->
          <button
            (click)="toggleChapter(chapter.id)"
            class="w-full px-4 py-3 rounded-lg transition-all duration-300 flex items-center justify-between group"
            [class.bg-gradient-to-r]="expandedChapters().has(chapter.id)"
            [class.from-red-500]="expandedChapters().has(chapter.id)"
            [class.to-pink-600]="expandedChapters().has(chapter.id)"
            [class.text-white]="expandedChapters().has(chapter.id)"
            [class.bg-gray-50]="!expandedChapters().has(chapter.id)"
            [class.hover:bg-gray-100]="!expandedChapters().has(chapter.id)"
            [class.text-gray-800]="!expandedChapters().has(chapter.id)">
            <h3 class="font-semibold text-sm flex-1 text-left">{{ chapter.title }}</h3>
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              class="h-5 w-5 transition-transform duration-300"
              [class.rotate-180]="expandedChapters().has(chapter.id)"
              fill="none" 
              viewBox="0 0 24 24" 
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <!-- Sections - expandable -->
          @if (expandedChapters().has(chapter.id)) {
            <div class="mt-2 mb-3 ml-4 space-y-1">
              @for (section of chapter.sections; track section.id) {
                <a
                  href="#"
                  (click)="selectSection(section, $event)"
                  class="flex items-center px-4 py-2.5 text-sm rounded-lg transition-all duration-200"
                  [class.bg-gradient-to-r]="selectedSectionId() === section.id"
                  [class.from-red-500]="selectedSectionId() === section.id"
                  [class.to-pink-500]="selectedSectionId() === section.id"
                  [class.text-white]="selectedSectionId() === section.id"
                  [class.font-semibold]="selectedSectionId() === section.id"
                  [class.bg-gray-50]="selectedSectionId() !== section.id"
                  [class.text-gray-700]="selectedSectionId() !== section.id"
                  [class.hover:bg-gray-100]="selectedSectionId() !== section.id">
                  <span class="w-1.5 h-1.5 rounded-full mr-3" 
                        [class.bg-white]="selectedSectionId() === section.id"
                        [class.bg-red-400]="selectedSectionId() !== section.id"></span>
                  <span class="flex-1">{{ section.title }}</span>
                </a>
              }
            </div>
          }
        </li>
      }
    </ul>
  </nav>
</aside>

<!-- Pull-out tab when collapsed -->
@if (isCollapsed()) {
  <button
    (click)="toggleSidebar()"
    class="fixed left-0 top-1/2 -translate-y-1/2 bg-red-600 text-white px-2 py-6 rounded-r-lg shadow-lg hover:bg-red-700 active:bg-red-800 transition-all duration-200 flex items-center justify-center z-20 hover:px-3"
    title="Mở menu">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
    </svg>
  </button>
}

